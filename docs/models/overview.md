# Data Models Overview

TypeScript interfaces defining the application's data structures. Located in `models/`.

## Core Models

### DatabaseConnection
**File:** `models/database-connection.interface.ts`

Represents a saved database connection.

```typescript
interface DatabaseConnection {
  id: string;                    // UUID
  name: string;                  // Display name
  type: string;                  // Database type (e.g., "PostgreSQL")
  host: string;                  // Hostname or IP
  port: string;                  // Port number
  database: string;              // Database name
  username: string;              // Username
  password: string;              // Password (plain text)
  description?: string;          // Business context description
  status: "connected" | "disconnected";
  schemaFileId?: string;         // OpenAI file ID
  vectorStoreId?: string;        // OpenAI vector store ID
  createdAt: string;             // ISO timestamp
}
```

**Usage:**
```typescript
const newConnection: DatabaseConnection = {
  id: crypto.randomUUID(),
  name: "Production DB",
  type: "PostgreSQL",
  host: "db.example.com",
  port: "5432",
  database: "myapp",
  username: "admin",
  password: "secret",
  description: "E-commerce production database",
  status: "disconnected",
  createdAt: new Date().toISOString()
};
```

**Notes:**
- `schemaFileId` and `vectorStoreId` are populated after schema upload
- `status` is managed by context, not user-set
- Only `type: "PostgreSQL"` is actually implemented

---

### Schema
**File:** `models/schema.interface.ts`

Container for database schema linked to a connection.

```typescript
interface Schema {
  connectionId: string;    // Links to DatabaseConnection.id
  tables: DatabaseTable[];
}
```

**Usage:**
```typescript
const schema: Schema = {
  connectionId: "abc-123",
  tables: [
    { name: "customers", columns: [...] },
    { name: "orders", columns: [...] }
  ]
};
```

---

### DatabaseTable
**File:** `models/database-table.interface.ts`

Represents a database table.

```typescript
interface DatabaseTable {
  name: string;               // Table name
  columns: Column[];          // Column definitions
  description?: string;       // Manual description
  aiDescription?: string;     // AI-generated description
  hidden?: boolean;           // Hide from query generation
  isNew?: boolean;            // Marked new after re-introspection
}
```

**Description Fields:**
- `description` - User-provided description
- `aiDescription` - Generated by OpenAI or fallback generator
- Display priority: `description` > `aiDescription` > default

---

### Column
**File:** `models/column.interface.ts`

Represents a table column.

```typescript
interface Column {
  name: string;               // Column name
  type: string;               // Data type (e.g., "integer", "varchar")
  nullable: boolean;          // Allows NULL
  primary_key?: boolean;      // Is primary key
  foreign_key?: string;       // FK reference (e.g., "users.id")
  description?: string;       // Manual description
  aiDescription?: string;     // AI-generated description
  hidden?: boolean;           // Hide from query generation
  isNew?: boolean;            // Marked new after re-introspection
  isModified?: boolean;       // Type changed after re-introspection
}
```

**Foreign Key Format:**
```typescript
// Format: "table_name.column_name"
{ foreign_key: "customers.id" }
{ foreign_key: "products.product_id" }
```

---

### SavedReport
**File:** `models/saved-report.interface.ts`

Represents a saved/parameterized report.

```typescript
interface SavedReport {
  id: string;
  connectionId: string;

  // Report metadata
  name: string;
  description?: string;

  // Query information
  naturalLanguageQuery: string;  // Original prompt
  sql: string;                   // Generated SQL (may contain {{parameters}})
  explanation: string;           // AI explanation
  warnings: string[];            // Any warnings
  confidence: number;            // AI confidence score

  // Parameters
  parameters?: ReportParameter[];

  // Timestamps
  createdAt: string;
  lastModified: string;
  lastRun?: string;

  // UI state
  isFavorite?: boolean;
}
```

**SQL with Parameters:**
```typescript
// Parameters in SQL use {{name}} syntax
{
  sql: "SELECT * FROM orders WHERE created_at > '{{start_date}}'",
  parameters: [
    { name: "start_date", type: "date", label: "Start Date" }
  ]
}
```

---

### ReportParameter
**File:** `models/saved-report.interface.ts`

Defines a report parameter.

```typescript
interface ReportParameter {
  name: string;                                    // Parameter identifier
  type: 'text' | 'number' | 'date' | 'datetime' | 'boolean';
  label: string;                                   // Display label
  defaultValue?: any;                              // Default value
  description?: string;                            // Help text
}
```

**Example:**
```typescript
const parameters: ReportParameter[] = [
  {
    name: "start_date",
    type: "date",
    label: "Start Date",
    defaultValue: "2024-01-01",
    description: "Beginning of reporting period"
  },
  {
    name: "category",
    type: "text",
    label: "Product Category",
    description: "Filter by category name"
  }
];
```

---

### ConnectionFormData
**File:** `models/connection-form-data.interface.ts`

Form data for creating/editing connections.

```typescript
interface ConnectionFormData {
  name: string;
  type: string;
  host: string;
  port: string;
  database: string;
  username: string;
  password: string;
  description?: string;
}
```

Used to separate form state from full `DatabaseConnection` model.

---

### DatabaseContextType
**File:** `models/database-context-type.interface.ts`

TypeScript interface for the database context.

```typescript
interface DatabaseContextType {
  // State
  connections: DatabaseConnection[];
  connectionStatus: "idle" | "success" | "error";
  connectionSchemas: Schema[];
  currentConnection?: DatabaseConnection;
  currentSchema?: Schema;
  isInitialized: boolean;

  // Methods
  setConnectionStatus: (status: "idle" | "success" | "error") => void;
  setCurrentConnection: (conn?: DatabaseConnection) => void;
  getConnection: (id?: string) => DatabaseConnection | undefined;
  addConnection: (conn: DatabaseConnection) => void;
  updateConnection: (conn: DatabaseConnection) => void;
  deleteConnection: (id: string) => void;
  importConnections: (conns: DatabaseConnection[]) => void;
  getSchema: (id?: string) => Schema | undefined;
  setSchema: (schema: Schema) => void;
  setCurrentSchema: (schema?: Schema) => void;
}
```

---

### ChartConfig
**File:** `models/chart-config.interface.ts`

Configuration for chart rendering.

```typescript
interface ChartConfig {
  type: 'bar' | 'line' | 'pie' | 'area' | 'scatter';
  title: string;
  xAxis: string;           // Column for X axis
  yAxis: string;           // Column for Y axis
  series: string[];        // Data series columns
  options?: {
    stacked?: boolean;
    showLegend?: boolean;
    colors?: string[];
  };
}
```

---

## Model Relationships

```
DatabaseConnection
        │
        │ connectionId
        ▼
     Schema
        │
        │ tables
        ▼
  DatabaseTable[]
        │
        │ columns
        ▼
    Column[]

DatabaseConnection
        │
        │ connectionId
        ▼
  SavedReport[]
        │
        │ parameters
        ▼
ReportParameter[]
```

## localStorage Keys

| Key | Type |
|-----|------|
| `databaseConnections` | `DatabaseConnection[]` |
| `currentDbConnection` | `DatabaseConnection` |
| `connectionSchemas` | `Schema[]` |
| `saved_reports` | `SavedReport[]` |
| `suggestions_{id}` | `Suggestion[]` |

---

## Type Safety Tips

### Null Checks
```typescript
// Always check for undefined
if (!currentConnection) return null;

// Optional chaining
const vectorStoreId = currentConnection?.vectorStoreId;

// Nullish coalescing
const description = column.description ?? column.aiDescription ?? "";
```

### Type Guards
```typescript
function isConnected(conn: DatabaseConnection): boolean {
  return conn.status === "connected";
}

function hasSchema(conn: DatabaseConnection): boolean {
  return !!conn.schemaFileId && !!conn.vectorStoreId;
}
```

---

## Related Documentation
- [State Management](../architecture/state-management.md) - How models are used in context
- [API Overview](../api/overview.md) - Request/response types
- [Components Overview](../components/overview.md) - Component props
